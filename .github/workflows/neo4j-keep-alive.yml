name: Keep AuraDB Awake

on:
  schedule:
    - cron: "0 */12 * * *"   # runs every 12 hours
  workflow_dispatch:         # allows manual trigger

jobs:
  keepalive:
    runs-on: ubuntu-latest

    steps:
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Install Neo4j driver
        run: pip install neo4j

      - name: Run keep-alive Cypher query
        env:
          NEO4J_URI: ${{ secrets.NEO4J_URI }}
          NEO4J_USERNAME: ${{ secrets.NEO4J_USERNAME }}
          NEO4J_PASSWORD: ${{ secrets.NEO4J_PASSWORD }}
        run: |
          python - <<EOF
          from neo4j import GraphDatabase
          import os

          uri = os.environ["NEO4J_URI"]
          user = os.environ["NEO4J_USERNAME"]
          password = os.environ["NEO4J_PASSWORD"]

          driver = GraphDatabase.driver(uri, auth=(user, password))

          with driver.session() as session:
              result = session.run("MATCH (n) RETURN count(n) LIMIT 1")
              print("AuraDB keep-alive ping OK â€” node count:", result.single()[0])
          EOF
